machine:
  node:
    version: 0.11
  timezone:
    America/New_York

  environment:
    appname: tesla

  hosts:
    dev-tesla.reisys.com:  127.0.0.1
    uat-tesla.reisys.com:  127.0.0.1
    tesla.reisys.com:      127.0.0.1

  services:
    - elasticsearch
    - mongodb
    - docker

general:  
  artifacts:
    - artifacts/testing
    
notify:
  webhooks:
    # auto deploy nginx frontend
    - url: https://dashboard.tutum.co/api/v1/service/33f7ae14-2bc8-40d0-804a-8febf2984baf/trigger/88e8a003-add5-43e6-9bd3-d7a1f7ad02d0/call/

dependencies:
  pre:
  - npm install -g bower grunt-cli
  - gem install sass
  - gem install compass

test:
   override:
      - sh ./application/run-tests.sh

     
deployment:
  tutum:
    branch: develop
    commands:
      - docker login -e $TUTUM_EMAIL -u $TUTUM_USER -p $TUTUM_PASS tutum.co
      - docker build -t $TUTUM_USER/application_backend ./application/backend
      - docker tag $TUTUM_USER/application_backend tutum.co/$TUTUM_USER/application_backend
      - docker push tutum.co/$TUTUM_USER/application_backend
      - docker build -t $TUTUM_USER/application_frontend ./application/frontend
      - docker tag $TUTUM_USER/application_frontend tutum.co/$TUTUM_USER/application_frontend
      - docker push tutum.co/$TUTUM_USER/application_frontend
      - docker build -t $TUTUM_USER/lb ./infrastructure/lb/^M
      - docker tag $TUTUM_USER/lb tutum.co/$TUTUM_USER/lb^M
      - docker push tutum.co/$TUTUM_USER/lb^M

